import streamlit as st
import random

# --- ç¶²é è¨­å®š ---
st.set_page_config(page_title="çˆ­ç«¶æˆ°å ´ Battlefield of Despair", layout="wide")

# --- éŠæˆ²é¢¨æ ¼ CSS (é»ƒé‡‘è–åŸŸä¸»é¡Œ) ---
st.markdown("""
    <style>
    .main { background-color: #1a1a1a; color: #f1c40f; }
    .stButton>button { background-color: #f1c40f; color: black; font-weight: bold; border-radius: 10px; }
    h1 { color: #f1c40f; text-shadow: 2px 2px #000; }
    </style>
    """, unsafe_allow_html=True)

# --- éŠæˆ²é‚è¼¯èˆ‡è³‡æ–™åº« (Session State) ---
if 'player' not in st.session_state:
    st.session_state.player = {
        "level": 1,
        "gold": 1000,
        "class": None,
        "inventory": [],
        "is_owner": False
    }

# --- æ¨™é¡Œ ---
st.title("ğŸ® çˆ­ç«¶æˆ°å ´ï¼šé‡å•Ÿç´€å…ƒ (Web Edition)")
st.subheader("â€”â€” ç¹¼æ‰¿æ§ç¥å¤§äººçš„æ¦®è€€ï¼Œé‡å¡‘é»ƒé‡‘è–åŸŸ â€”â€”")

# --- 1. è§’è‰²é¸æ“‡ ---
if not st.session_state.player["class"]:
    st.info("è«‹é¸æ“‡ä½ çš„åˆå§‹è·éšï¼š")
    col1, col2, col3 = st.columns(3)
    if col1.button("ğŸ›¡ï¸ é‡è£å…ˆé‹’"):
        st.session_state.player["class"] = "é‡è£å…ˆé‹’"
        st.rerun()
    if col2.button("ğŸ—¡ï¸ æš—å½±çµæ®ºè€…"):
        st.session_state.player["class"] = "æš—å½±çµæ®ºè€…"
        st.rerun()
    if col3.button("ğŸ“¡ æœªä¾†æ”¯æ´å®˜"):
        st.session_state.player["class"] = "æœªä¾†æ”¯æ´å®˜"
        st.rerun()
else:
    # --- éŠæˆ²ä¸»è¦ä»‹é¢ ---
    p = st.session_state.player
    st.sidebar.markdown(f"### ğŸ‘¤ ç©å®¶ç‹€æ…‹")
    st.sidebar.write(f"è·éš: **{p['class']}**")
    st.sidebar.write(f"ç­‰ç´š: **Lv. {p['level']}**")
    st.sidebar.write(f"æŒæœ‰é‡‘å¹£: **{p['gold']} G**")
    
    # --- åŠŸèƒ½å€ ---
    tab1, tab2, tab3 = st.tabs(["âš”ï¸ é€²å…¥æˆ°å ´", "ğŸ æ¯æ—¥æŠ½ç", "ğŸ’ é¦–å¯Œç‰¹æ¬Š"])

    with tab1:
        st.write("ç›®å‰æ‰€åœ¨åœ°ï¼š**éœ“è™¹éƒ½å¸‚ä¸­å¿ƒ**")
        if st.button("ç™¼èµ·çªæ“Šï¼"):
            win = random.random() > 0.3
            if win:
                reward = 500 * p['level']
                p['gold'] += reward
                p['level'] += 1
                st.success(f"æˆ°é¬¥å‹åˆ©ï¼ç²å¾— {reward} Gï¼Œç­‰ç´šæå‡ï¼")
            else:
                st.error("çªæ“Šå¤±æ•—ï¼Œè£ç”²å—æï¼Œå¹¸å¥½æ’¤é€€æˆåŠŸã€‚")

    with tab2:
        st.write("æ¯æ—¥å…è²»æ¸¬è©¦è£å‚™ï¼ˆæ¯æ—¥ä¸€æ¬¡ï¼‰")
        if st.button("ç«‹åˆ»æŠ½å–"):
            items = ["[ç„šå¤©ä¹‹æ€’] æ®˜ç‰‡", "[æµå…‰æˆ°ç”²] é›¶ä»¶", "å¤©ç©ºæ ¸å¿ƒç¢å¡Š"]
            got = random.choice(items)
            p['inventory'].append(got)
            st.warning(f"æ­å–œç²å¾—ï¼š{got}ï¼")

    with tab3:
        st.write("æƒ³æˆç‚ºåƒã€Œæ§ç¥å¤§äººã€ä¸€æ¨£çš„é¦–å¯Œå—ï¼Ÿ")
        if st.button("æˆ‘è¦å„²å€¼ (10000 G)"):
            p['gold'] += 10000
            st.balloons()
            st.success("å„²å€¼æˆåŠŸï¼é‡‘å¹£å·²å…¥å¸³ã€‚")
